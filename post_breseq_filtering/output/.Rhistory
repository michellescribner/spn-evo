df$'Order Choice' <- typeseq
df$ExperimentName <- gsub("NVLV-M07275-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M05339-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M06025-", "", df$ExperimentName)
df$ExperimentName <- as.Date(df$ExperimentName, format = "%Y%m%d")
df <- df %>%
filter(ExperimentName != "2022-01-31")
df %>%
filter(ExperimentName == date1 | ExperimentName == "2022-02-16") %>%
write.csv(file = paste("TerraData-", date1, ".csv", sep = ""), row.names = FALSE)
# Quality filter
df2 <- df %>%
select(entity.respseq_id, nextclade_clade,pango_lineage,
ExperimentName, run_id, assembly_length_unambiguous,
assembly_mean_coverage, vadr_num_alerts, percent_reference_coverage)
df2$quality <- FALSE
df2$quality[df2$percent_reference_coverage > 89.99] <- TRUE
df_excluded <-  df2 %>%
filter(quality == FALSE)
df2 <-  df2 %>%
filter(quality == TRUE)
df3 <- df2 %>%
filter(ExperimentName == date1)
cat(paste("Of the 96 samples sequenced on this run,", nrow(df3), "genomes passed quality control, defined as 90% coverage of the SARS-CoV-2 reference genome."))
c <- df3 %>% count(nextclade_clade) %>%
ggplot(aes(x="", y=n, fill=nextclade_clade)) +
coord_polar("y", start=0) + geom_bar(stat="identity", width=1) +
theme_void() +
labs(title ="SARS-CoV-2 Clades", fill="Clade")
pal <- distinctColorPalette(k = nrow(df3 %>% count(pango_lineage)), altCol = FALSE, runTsne = FALSE)
l <- df3 %>% count(pango_lineage) %>%
ggplot(aes(x="", y=n, fill=pango_lineage)) +
coord_polar("y", start=0) + geom_bar(stat="identity", width=1) +
theme_void() +
scale_fill_manual(values = pal)+
labs(title ="SARS-CoV-2 Lineages", fill="Lineage")
figure <- ggarrange(c, l, ncol = 2, nrow = 1)
plot(figure)
df2 %>%
filter(ExperimentName == date1) %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Week = as.Date(date1)) %>%
kable()
df_excluded %>%
filter(ExperimentName == date1) %>%
select(entity.respseq_id,nextclade_clade,
pango_lineage,ExperimentName,percent_reference_coverage,
assembly_mean_coverage) %>%
arrange(desc(percent_reference_coverage)) %>%
mutate(percent_reference_coverage=paste0(percent_reference_coverage,"%")) %>%
rename('Sample ID'= entity.respseq_id,'Lineage' = pango_lineage,
'Clade' = nextclade_clade,'Week'=ExperimentName,
'Reference Coverage' = percent_reference_coverage,'Mean Read Depth'=assembly_mean_coverage) %>%
kable()
df2$ExperimentName <- as.Date(df2$ExperimentName)
df4 <- df2[df2$ExperimentName >= date2 & df2$ExperimentName <= date1, ]
pal <- distinctColorPalette(k = nrow(df4 %>% group_by(nextclade_clade) %>% count()), altCol = FALSE, runTsne = FALSE)
c <- df4 %>% count(nextclade_clade, ExperimentName) %>%
ggplot(aes(x=ExperimentName, y=n, fill=nextclade_clade)) +
geom_bar(position="stack", stat="identity", color="white", size = 0.1) +
theme_minimal() +
scale_fill_manual(values = pal)+
labs(title ="SARS-CoV-2 Clades", y = "Number of Samples", x="Sequencing Run", fill="Clade") +
theme(axis.text.x = element_text(angle = 45,hjust=1), legend.position = "bottom")
df4 <- df4 %>%
group_by(pango_lineage) %>%
mutate(count = n())
df4$lin[df4$count < 5] <- "other"
d <- df4 %>%
filter(lin == "other")
df4$lin <- df4$pango_lineage
df4 <- df4 %>%
group_by(pango_lineage) %>%
mutate(count = n())
df4$lin[df4$count < 5] <- "other"
d <- df4 %>%
filter(lin == "other")
d <- unique(d$pango_lineage)
d <- paste(d, collapse = ", ")
pal <- distinctColorPalette(k = nrow(df4 %>% group_by(lin) %>% count()), altCol = FALSE, runTsne = FALSE)
figure <- ggarrange(c, l,
ncol = 1, nrow = 2, align = "v",
heights = c(3,4))
plot(figure)
pal <- distinctColorPalette(k = nrow(df4 %>% group_by(lin) %>% count()), altCol = FALSE, runTsne = FALSE)
l <-  df4 %>% count(pango_lineage, ExperimentName, lin) %>%
ggplot(aes(x=ExperimentName, y=n, fill=lin)) +
geom_bar(position="stack", stat="identity", color="white", size=0.1) +
theme_minimal() +
scale_fill_manual(values = pal)+
labs(title ="SARS-CoV-2 Lineages", y = "Number of Samples", x="Sequencing Run", fill="Lineage") +
theme(axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.length = unit(0, "mm"), plot.margin = margin(20,10,10,10),
legend.position = "bottom")
figure <- ggarrange(c, l,
ncol = 1, nrow = 2, align = "v",
heights = c(3,4))
plot(figure)
# Read data into R
dfr <- read.csv(file = 'respseq.tsv', sep = "\t", header = TRUE)
dfr <- dfr %>%
select(entity.respseq_id, assembly_length_unambiguous, number_N,percent_reference_coverage,
assembly_mean_coverage, nextclade_clade,nextclade_aa_dels, nextclade_aa_subs,pango_lineage,
ExperimentName, run_id, vadr_num_alerts, titan_illumina_pe_analysis_date, titan_illumina_pe_version)
dfc <- read.csv(file = 'covidseq.tsv', sep = "\t", header = TRUE)
dfc <- dfc %>%
select(entity.covidseq_id, assembly_length_unambiguous, number_N,percent_reference_coverage,
assembly_mean_coverage, nextclade_clade,nextclade_aa_dels, nextclade_aa_subs,pango_lineage,
ExperimentName, run_id, vadr_num_alerts, titan_illumina_pe_analysis_date, titan_illumina_pe_version)
colnames(dfc) <- colnames(dfr)
df <- rbind(dfc, dfr)
# Create table for Orchard
df$'From Where' <- "Miseq"
df$'Order Choice' <- typeseq
df$ExperimentName <- gsub("NVLV-M07275-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M05339-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M06025-", "", df$ExperimentName)
df$ExperimentName <- as.Date(df$ExperimentName, format = "%Y%m%d")
df <- df %>%
filter(ExperimentName != "2022-01-31")
View(df)
df %>%
filter(ExperimentName %in% c("2022-02-16","2022-02-18")) %>%
write.csv(file = paste("TerraData-", date1, ".csv", sep = ""), row.names = FALSE)
# Quality filter
df2 <- df %>%
select(entity.respseq_id, nextclade_clade,pango_lineage,
ExperimentName, run_id, assembly_length_unambiguous,
assembly_mean_coverage, vadr_num_alerts, percent_reference_coverage)
df2$quality <- FALSE
df2$quality[df2$percent_reference_coverage > 89.99] <- TRUE
df_excluded <-  df2 %>%
filter(quality == FALSE)
df2 <-  df2 %>%
filter(quality == TRUE)
df3 <- df2 %>%
filter(ExperimentName  %in% c("2022-02-16","2022-02-18"))
cat(paste("Of the 96 samples sequenced on this run,", nrow(df3), "genomes passed quality control, defined as 90% coverage of the SARS-CoV-2 reference genome."))
df3 <- df2 %>%
filter(ExperimentName %in% c("2022-02-16","2022-02-18"))
cat(paste("Of the 192 samples sequenced on these runs,", nrow(df3), "genomes passed quality control, defined as 90% coverage of the SARS-CoV-2 reference genome."))
# Quality filter
df2 <- df %>%
select(entity.respseq_id, nextclade_clade,pango_lineage,
ExperimentName, run_id, assembly_length_unambiguous,
assembly_mean_coverage, vadr_num_alerts, percent_reference_coverage)
View(df2)
df2$quality <- FALSE
df2$quality[df2$percent_reference_coverage > 89.99] <- TRUE
df_excluded <-  df2 %>%
filter(quality == FALSE)
df2 <-  df2 %>%
filter(quality == TRUE)
df3 <- df2 %>%
filter(ExperimentName %in% c("2022-02-16","2022-02-18"))
View(df3)
date <- c("2022-02-16","2022-02-18")
df3 <- df2 %>%
filter(ExperimentName %in% date)
head(df2)
date <- "2022-02-16"
df3 <- df2 %>%
filter(ExperimentName %in% date)
cat(paste("Of the 192 samples sequenced on these runs,", nrow(df3), "genomes passed quality control, defined as 90% coverage of the SARS-CoV-2 reference genome."))
date <- "2022-02-16"
df3 <- df2 %>%
filter(ExperimentName == date)
head(df3)
df3$ExperimentName
date <- c("2022-02-16","2022-02-16")
date <- c("2022-02-16","2022-02-16")
df3 <- filter(df2, ExperimentName %in% date)
?%in%
date <- c("2022-02-16","2022-02-18")
df3 <- filter(df2, ExperimentName %in% date)
date <- "2022-02-16"
df3 <- filter(df2, ExperimentName == date)
df3 <- filter(df2, ExperimentName == "2022-02-16")
df32 <- filter(df2, ExperimentName == "2022-02-18")
df3 <- rbind(df3,df32)
cat(paste("Of the 192 samples sequenced on these runs,", nrow(df3), "genomes passed quality control, defined as 90% coverage of the SARS-CoV-2 reference genome."))
c <- df3 %>% count(nextclade_clade) %>%
ggplot(aes(x="", y=n, fill=nextclade_clade)) +
coord_polar("y", start=0) + geom_bar(stat="identity", width=1) +
theme_void() +
labs(title ="SARS-CoV-2 Clades", fill="Clade")
df2 %>%
filter(ExperimentName == date1) %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Week = as.Date(date1)) %>%
kable()
df %>%
filter(ExperimentName == "2022-02-18") %>%
write.csv(file = paste("TerraData-", date1, ".csv", sep = ""), row.names = FALSE)
df %>%
filter(ExperimentName == "2022-02-18") %>%
write.csv(file = paste("TerraData-", date1, ".csv", sep = ""), row.names = FALSE)
df %>%
filter(ExperimentName == "2022-02-16") %>%
write.csv(file = paste("TerraData-2022-02-16", ".csv", sep = ""), row.names = FALSE)
date1
date2
View(df4)
cat(paste("During the week of ", datename, ", 192 samples were sequenced using ", typeseqlong, sep = ""))
cat(paste("Sample collection dates ranged from ", coldate1, " to ", coldate2, sep = ""))
# Read data into R
dfr <- read.csv(file = 'respseq.tsv', sep = "\t", header = TRUE)
dfr <- dfr %>%
select(entity.respseq_id, assembly_length_unambiguous, number_N,percent_reference_coverage,
assembly_mean_coverage, nextclade_clade,nextclade_aa_dels, nextclade_aa_subs,pango_lineage,
ExperimentName, run_id, vadr_num_alerts, titan_illumina_pe_analysis_date, titan_illumina_pe_version)
dfc <- read.csv(file = 'covidseq.tsv', sep = "\t", header = TRUE)
dfc <- dfc %>%
select(entity.covidseq_id, assembly_length_unambiguous, number_N,percent_reference_coverage,
assembly_mean_coverage, nextclade_clade,nextclade_aa_dels, nextclade_aa_subs,pango_lineage,
ExperimentName, run_id, vadr_num_alerts, titan_illumina_pe_analysis_date, titan_illumina_pe_version)
colnames(dfc) <- colnames(dfr)
df <- rbind(dfc, dfr)
# Create table for Orchard
df$'From Where' <- "Miseq"
df$'Order Choice' <- typeseq
df$ExperimentName <- gsub("NVLV-M07275-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M05339-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M06025-", "", df$ExperimentName)
df$ExperimentName <- as.Date(df$ExperimentName, format = "%Y%m%d")
df <- df %>%
filter(ExperimentName != "2022-01-31")
df %>%
filter(ExperimentName == "2022-02-18") %>%
write.csv(file = paste("TerraData-",date1, ".csv", sep = ""), row.names = FALSE)
# Quality filter
df2 <- df %>%
select(entity.respseq_id, nextclade_clade,pango_lineage,
ExperimentName, run_id, assembly_length_unambiguous,
assembly_mean_coverage, vadr_num_alerts, percent_reference_coverage)
df2$quality <- FALSE
df2$quality[df2$percent_reference_coverage > 89.99] <- TRUE
df_excluded <-  df2 %>%
filter(quality == FALSE)
df2 <-  df2 %>%
filter(quality == TRUE)
df3 <- filter(df2, ExperimentName == "2022-02-16")
df32 <- filter(df2, ExperimentName == "2022-02-18")
df3 <- rbind(df3,df32)
cat(paste("Of the 192 samples sequenced on these runs,", nrow(df3), "genomes passed quality control, defined as 90% coverage of the SARS-CoV-2 reference genome. One sample was a coroner sample, but was excluded from subsequent analysis due to low genome coverage. All samples but one were S-gene target failures. "))
c <- df3 %>% count(nextclade_clade) %>%
ggplot(aes(x="", y=n, fill=nextclade_clade)) +
coord_polar("y", start=0) + geom_bar(stat="identity", width=1) +
theme_void() +
labs(title ="SARS-CoV-2 Clades", fill="Clade")
pal <- distinctColorPalette(k = nrow(df3 %>% count(pango_lineage)), altCol = FALSE, runTsne = FALSE)
l <- df3 %>% count(pango_lineage) %>%
ggplot(aes(x="", y=n, fill=pango_lineage)) +
coord_polar("y", start=0) + geom_bar(stat="identity", width=1) +
theme_void() +
scale_fill_manual(values = pal)+
labs(title ="SARS-CoV-2 Lineages", fill="Lineage")
figure <- ggarrange(c, l, ncol = 2, nrow = 1)
plot(figure)
df2 %>%
filter(ExperimentName == date1) %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Week = as.Date(date1)) %>%
kable()
df2 %>%
filter(ExperimentName == "2022-02-16") %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Run = "2022-02-16") %>%
kable()
df2 %>%
filter(ExperimentName == date1) %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Run = as.Date(date1)) %>%
kable()
df2 %>%
filter(ExperimentName == "2022-02-16") %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Run = "2022-02-16") %>%
kable()
df2 %>%
filter(ExperimentName == date1) %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Run = as.Date(date1)) %>%
kable()
df3 %>%
count(pango_lineage, nextclade_clade) %>%
mutate(Percentage=paste0(round(n/sum(n)*100,2),"%")) %>%
arrange(desc(n)) %>%
rename('Number of Samples' = n) %>%
rename('Lineage' = pango_lineage, 'Clade' = nextclade_clade) %>%
add_column(Run = as.Date(date1)) %>%
kable()
df2$ExperimentName <- as.Date(df2$ExperimentName)
df4 <- df2[df2$ExperimentName >= date2 & df2$ExperimentName <= date1, ]
pal <- distinctColorPalette(k = nrow(df4 %>% group_by(nextclade_clade) %>% count()), altCol = FALSE, runTsne = FALSE)
c <- df4 %>% count(nextclade_clade, ExperimentName) %>%
ggplot(aes(x=ExperimentName, y=n, fill=nextclade_clade)) +
geom_bar(position="stack", stat="identity", color="white", size = 0.1) +
theme_minimal() +
scale_fill_manual(values = pal)+
labs(title ="SARS-CoV-2 Clades", y = "Number of Samples", x="Sequencing Run", fill="Clade") +
theme(axis.text.x = element_text(angle = 45,hjust=1), legend.position = "bottom")
df4$lin <- df4$pango_lineage
df4 <- df4 %>%
group_by(pango_lineage) %>%
mutate(count = n())
df4$lin[df4$count < 5] <- "other"
d <- df4 %>%
filter(lin == "other")
d <- unique(d$pango_lineage)
d <- paste(d, collapse = ", ")
pal <- distinctColorPalette(k = nrow(df4 %>% group_by(lin) %>% count()), altCol = FALSE, runTsne = FALSE)
l <-  df4 %>% count(pango_lineage, ExperimentName, lin) %>%
ggplot(aes(x=ExperimentName, y=n, fill=lin)) +
geom_bar(position="stack", stat="identity", color="white", size=0.1) +
theme_minimal() +
scale_fill_manual(values = pal)+
labs(title ="SARS-CoV-2 Lineages", y = "Number of Samples", x="Sequencing Run", fill="Lineage") +
theme(axis.text.x = element_text(angle = 45, hjust=1),
axis.ticks.length = unit(0, "mm"), plot.margin = margin(20,10,10,10),
legend.position = "bottom")
figure <- ggarrange(c, l,
ncol = 1, nrow = 2, align = "v",
heights = c(3,4))
plot(figure)
date1
df_excluded %>%
filter(ExperimentName %in% "2022-02-16")
df_excluded %>%
filter(ExperimentName %in% "2022-02-18")
df_excluded %>%
filter(ExperimentName == date1|ExperimentName =="2022-02-16") %>%
select(entity.respseq_id,nextclade_clade,
pango_lineage,ExperimentName,percent_reference_coverage,
assembly_mean_coverage) %>%
arrange(desc(percent_reference_coverage)) %>%
mutate(percent_reference_coverage=paste0(percent_reference_coverage,"%")) %>%
rename('Sample ID'= entity.respseq_id,'Lineage' = pango_lineage,
'Clade' = nextclade_clade,'Week'=ExperimentName,
'Reference Coverage' = percent_reference_coverage,'Mean Read Depth'=assembly_mean_coverage) %>%
kable()
df_excluded %>%
filter(ExperimentName == date1|ExperimentName =="2022-02-16") %>%
select(entity.respseq_id,nextclade_clade,
pango_lineage,ExperimentName,percent_reference_coverage,
assembly_mean_coverage) %>%
arrange(desc(percent_reference_coverage)) %>%
arrange(ExperimentName) %>%
mutate(percent_reference_coverage=paste0(percent_reference_coverage,"%")) %>%
rename('Sample ID'= entity.respseq_id,'Lineage' = pango_lineage,
'Clade' = nextclade_clade,'Week'=ExperimentName,
'Reference Coverage' = percent_reference_coverage,'Mean Read Depth'=assembly_mean_coverage) %>%
kable()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggpubr)
library(randomcoloR)
library(knitr)
# Read data into R
dfr <- read.csv(file = 'respseq.tsv', sep = "\t", header = TRUE)
# Read data into R
dfr <- read.csv(file = 'respseq.tsv', sep = "\t", header = TRUE)
dfr <- dfr %>%
select(entity.respseq_id, assembly_length_unambiguous, number_N,percent_reference_coverage,
assembly_mean_coverage, nextclade_clade,nextclade_aa_dels, nextclade_aa_subs,pango_lineage,
ExperimentName, run_id, vadr_num_alerts, titan_illumina_pe_analysis_date, titan_illumina_pe_version)
dfc <- read.csv(file = 'covidseq.tsv', sep = "\t", header = TRUE)
dfc <- dfc %>%
select(entity.covidseq_id, assembly_length_unambiguous, number_N,percent_reference_coverage,
assembly_mean_coverage, nextclade_clade,nextclade_aa_dels, nextclade_aa_subs,pango_lineage,
ExperimentName, run_id, vadr_num_alerts, theiacov_illumina_pe_analysis_date, theiacov_illumina_pe_version)
colnames(dfr) <- colnames(dfc)
df <- rbind(dfc, dfr)
# Create table for Orchard
df$'From Where' <- "Miseq"
df$'Order Choice' <- typeseq
df$ExperimentName <- gsub("NVLV-M07275-", "", df$ExperimentName)
df <- rbind(dfc, dfr)
# Create table for Orchard
df$'From Where' <- "Miseq"
df$'Order Choice' <- typeseq
df$'Order Choice' <- typeseq
datename <- "February 14th-18th, 2022" # date
typeseq <- "COVIDSEQ" # kit used for sequencing
typeseqlong <- "the COVIDSeq kit from Illumina with Artic v4 primers.  "
coldate1 <- "February 2nd, 2022" # earliest sample collection date on the run
coldate2 <- "February 10th, 2022. " # latest sample collection date on the run
date1 <- "2022-02-18" # run date
date2 <- "2021-11-01" # earliest date to show in cumulative sequencing plot
p <- "1" #coroner samples
q <- "191" #SGTF
df$'Order Choice' <- typeseq
df$ExperimentName <- gsub("NVLV-M07275-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M05339-", "", df$ExperimentName)
df$ExperimentName <- gsub("NVLV-M06025-", "", df$ExperimentName)
df$ExperimentName <- as.Date(df$ExperimentName, format = "%Y%m%d")
df <- df %>%
filter(ExperimentName != "2022-01-31")
df %>%
filter(ExperimentName == "2022-02-18") %>%
write.csv(file = paste("TerraData-",date1, ".csv", sep = ""), row.names = FALSE)
df %>%
filter(ExperimentName == "2022-02-16") %>%
write.csv(file = paste("TerraData-2022-02-16",".csv", sep = ""), row.names = FALSE)
df %>%
filter(ExperimentName == "2022-02-18") %>%
write.csv(file = paste("TerraData-",date1,".csv", sep = ""), row.names = FALSE)
df_excluded %>%
filter(ExperimentName == date1|ExperimentName =="2022-02-16") %>%
select(entity.covidseq_id,nextclade_clade,
pango_lineage,ExperimentName,percent_reference_coverage,
assembly_mean_coverage) %>%
arrange(desc(percent_reference_coverage)) %>%
arrange(ExperimentName) %>%
mutate(percent_reference_coverage=paste0(percent_reference_coverage,"%")) %>%
mutate_if(is.numeric, round, 1) %>%
rename('Sample ID'= entity.covidseq_id,'Lineage' = pango_lineage,
'Clade' = nextclade_clade,'Week'=ExperimentName,
'Reference Coverage' = percent_reference_coverage,'Mean Read Depth'=assembly_mean_coverage) %>%
kable()
# Quality filter
df2 <- df %>%
select(entity.covidseq_id, nextclade_clade,pango_lineage,
ExperimentName, run_id, assembly_length_unambiguous,
assembly_mean_coverage, vadr_num_alerts, percent_reference_coverage)
df2$quality <- FALSE
df2$quality[df2$percent_reference_coverage > 89.99] <- TRUE
df_excluded <-  df2 %>%
filter(quality == FALSE)
df2 <-  df2 %>%
filter(quality == TRUE)
df_excluded %>%
filter(ExperimentName == date1|ExperimentName =="2022-02-16") %>%
select(entity.covidseq_id,nextclade_clade,
pango_lineage,ExperimentName,percent_reference_coverage,
assembly_mean_coverage) %>%
arrange(desc(percent_reference_coverage)) %>%
arrange(ExperimentName) %>%
mutate(percent_reference_coverage=paste0(percent_reference_coverage,"%")) %>%
mutate_if(is.numeric, round, 1) %>%
rename('Sample ID'= entity.covidseq_id,'Lineage' = pango_lineage,
'Clade' = nextclade_clade,'Week'=ExperimentName,
'Reference Coverage' = percent_reference_coverage,'Mean Read Depth'=assembly_mean_coverage) %>%
kable()
library(tidyverse)
setwd("/Users/mrs/Documents/pitt/streppneumo/post_breseq_filtering/output")
snps <- read.csv('percent_mapped_reads.csv')
clean_samplenames <- function(snps) {
snps$sample <- gsub("G([1-9]{1})$", "G0\\1", as.character(snps$sample))
snps$sample <- gsub("G([1-9]{1})R", "G0\\1", as.character(snps$sample))
# separate sample names into columns
snps <- separate(snps, sample, into = c("drug", "immune", "pop", "gen", "garbage"), sep = c(2, 4, 6, 9), remove = FALSE)
# remove samples that aren't in the drug and immune treatment list
drugs <- c("Ce", "Le", "Li", "Ci", "Az", "Im", "Va", "Pe", "Ri", "Me")
immune <- c("M0", "N0", "Nd")
snps <- snps[ (snps$drug %in% drugs), ]
snps <- snps[ (snps$immune %in% immune), ]
# create new columns by pasting other columns
snps$treat <- paste(snps$drug, snps$immune, sep = "")
snps$lineage <- paste(snps$drug, snps$immune, snps$pop, sep = "")
snps$sample <- paste(snps$drug, snps$immune, snps$pop, snps$gen, sep = "")
snps$treat <- paste(snps$drug, snps$immune, sep = "")
# remove G from generation name
snps$gen <- gsub("G", "", snps$gen)
return(snps)
}
df <- clean_samplenames(snps)
df %>%
group_by(drug,immune) %>%
summarize(mean = mean(percent_mapped_bases)) %>%
ggplot(aes(x=drug,y=mean,color=immune)) +
geom_point()
df %>%
group_by(immune) %>%
summarize(mean = mean(percent_mapped_bases)) %>%
ggplot(aes(x=immune,y=mean,color=immune)) +
geom_point()
df %>%
ggplot(mapping = aes(x=gen, y=percent_mapped_bases, color=pop)) +
geom_point(size =1) +
ylab("CFU per Lung (log10)") +
xlab("Passage") +
theme_bw() +
facet_wrap(vars(drug,immune))
